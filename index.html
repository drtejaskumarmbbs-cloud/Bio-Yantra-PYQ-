<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bio Yantra PYQ - Google Auth Edition</title>
    <!-- Essential CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .btn-active:active { transform: scale(0.96); }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 1.5rem; }
        .video-container iframe, .viewer-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .sidebar-anim { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { indigo: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81' } } } }
        }
    </script>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 transition-colors duration-300">
    <div id="root"></div>

    <!-- Firebase SDK Modular -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-firestore.js";

        window.FirebaseAPI = { 
            initializeApp, getAuth, GoogleAuthProvider, signInWithPopup, 
            onAuthStateChanged, signOut, getFirestore, doc, setDoc, getDoc, collection 
        };
    </script>

    <!-- External Data File -->
    <script src="data.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyAt-vQ9broxgBbl0Wx_bxCy9AH8vdZiRE8",
            authDomain: "bio-yantra-pyq.firebaseapp.com",
            projectId: "bio-yantra-pyq",
            storageBucket: "bio-yantra-pyq.firebasestorage.app",
            messagingSenderId: "222151879306",
            appId: "1:222151879306:web:a0562af8ae4fcfc5255b73"
        };

        const CHAPTER_DATA = {
            "11": ["The Living World", "Biological Classification", "Plant Kingdom", "Animal Kingdom", "Morphology of Flowering Plants", "Anatomy of Flowering Plants", "Structural Organisation in Animals", "Cell: The Unit of Life", "Biomolecules", "Cell Cycle and Cell Division", "Photosynthesis in Higher Plants", "Respiration in Plants", "Plant Growth and Development", "Breathing and Exchange of Gases", "Body Fluids and Circulation", "Excretory Products and their Elimination", "Locomotion and Movement", "Neural Control and Coordination", "Chemical Coordination and Integration"],
            "12": ["Sexual Reproduction in Flowering Plants", "Human Reproduction", "Reproductive Health", "Principles of Inheritance and Variation", "Molecular Basis of Inheritance", "Evolution", "Human Health and Disease", "Microbes in Human Welfare", "Biotechnology: Principles and Processes", "Biotechnology and its Applications", "Organisms and Populations", "Ecosystem", "Biodiversity and Conservation"]
        };

        const YEAR_RANGE = Array.from({ length: 16 }, (_, i) => 2010 + i);

        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && name && iconRef.current) {
                    iconRef.current.innerHTML = `<i data-lucide="${name}" stroke-width="2.5" style="width:${size}px; height:${size}px;" class="${className}"></i>`;
                    window.lucide.createIcons();
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="inline-flex items-center"></span>;
        };

        const AuthWall = ({ onLogin }) => (
            <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-slate-50 dark:bg-slate-950 fade-in">
                <div className="w-full max-w-md p-8 bg-white dark:bg-slate-900 rounded-[3rem] shadow-2xl border dark:border-slate-800 text-center">
                    <div className="inline-flex p-5 bg-indigo-100 dark:bg-indigo-900/30 rounded-3xl mb-6 text-indigo-600">
                        <Icon name="zap" size={48} />
                    </div>
                    <h1 className="text-4xl font-black dark:text-white mb-2 tracking-tight">BIO <span className="text-indigo-500">YANTRA</span></h1>
                    <p className="text-slate-500 dark:text-slate-400 mb-10 font-bold tracking-wide">Please sign in to access PYQs & Analysis</p>
                    
                    <button onClick={onLogin} className="w-full h-16 bg-white dark:bg-slate-800 border dark:border-slate-700 rounded-2xl flex items-center justify-center gap-4 text-lg font-black dark:text-slate-100 shadow-lg btn-active transition-all hover:bg-slate-50 dark:hover:bg-slate-700">
                        <svg className="w-6 h-6" viewBox="0 0 48 48">
                            <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z" />
                            <path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z" />
                            <path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z" />
                            <path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z" />
                        </svg>
                        Continue with Google
                    </button>
                    
                    <p className="mt-8 text-[10px] text-slate-400 font-bold uppercase tracking-widest">Secure NCERT Education Portal</p>
                </div>
            </div>
        );

        const Sidebar = ({ user, isOpen, onClose, navigate, currentView, onLogout }) => (
            <div className={`fixed inset-0 z-[200] ${isOpen ? 'visible' : 'invisible'}`}>
                <div className={`fixed inset-0 bg-slate-950/60 backdrop-blur-sm transition-opacity ${isOpen ? 'opacity-100' : 'opacity-0'}`} onClick={onClose}></div>
                <div className={`fixed left-0 top-0 w-72 h-full bg-white dark:bg-slate-900 shadow-2xl sidebar-anim border-r dark:border-slate-800 flex flex-col ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                    <div className="p-6 border-b dark:border-slate-800 flex items-center gap-4">
                        <div className="w-12 h-12 bg-indigo-600 rounded-2xl overflow-hidden shadow-lg flex items-center justify-center">
                            {user?.photoURL ? <img src={user.photoURL} className="w-full h-full object-cover" /> : <Icon name="user" className="text-white" />}
                        </div>
                        <div className="min-w-0">
                            <h2 className="font-black text-sm dark:text-white truncate">{user?.displayName || "Medical Aspirant"}</h2>
                            <p className="text-[10px] text-slate-500 truncate">{user?.email}</p>
                        </div>
                    </div>
                    <div className="flex-1 py-4 px-3 space-y-1 overflow-y-auto no-scrollbar">
                        <button onClick={() => { navigate('home'); onClose(); }} className={`w-full flex items-center gap-4 px-4 py-3 rounded-2xl font-bold transition-all ${currentView === 'home' ? 'bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30' : 'text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800'}`}><Icon name="home" size={20} /> Home</button>
                        <button onClick={() => { navigate('performance'); onClose(); }} className={`w-full flex items-center gap-4 px-4 py-3 rounded-2xl font-bold transition-all ${currentView === 'performance' ? 'bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30' : 'text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800'}`}><Icon name="bar-chart-3" size={20} /> Performance</button>
                        <a href="https://wa.me/918229084161" target="_blank" className="w-full flex items-center gap-4 px-4 py-3 rounded-2xl font-bold text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800"><Icon name="message-circle" size={20} className="text-green-500" /> Support</a>
                    </div>
                    <div className="p-4 border-t dark:border-slate-800">
                        <button onClick={onLogout} className="w-full flex items-center gap-3 px-4 py-3 bg-red-500/10 text-red-500 rounded-xl font-black text-xs uppercase tracking-widest active:scale-95"><Icon name="log-out" size={16} /> Logout Account</button>
                    </div>
                </div>
            </div>
        );

        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('home');
            const [darkMode, setDarkMode] = useState(true);
            const [isSidebarOpen, setSidebarOpen] = useState(false);
            const [resourceFilter, setResourceFilter] = useState("all");
            const [filters, setFilters] = useState({ classLevel: "All", chapter: "All Chapters", startYear: 2010, endYear: 2025 });
            const [session, setSession] = useState({ questions: [], currentIndex: 0, userAnswers: {}, startTime: null });
            
            const authRef = useRef(null);
            const dbRef = useRef(null);

            useEffect(() => {
                const initFirebase = setInterval(() => {
                    if (window.FirebaseAPI) {
                        const { initializeApp, getAuth, onAuthStateChanged } = window.FirebaseAPI;
                        const app = initializeApp(firebaseConfig);
                        authRef.current = getAuth(app);
                        onAuthStateChanged(authRef.current, (u) => {
                            setUser(u);
                            setLoading(false);
                        });
                        clearInterval(initFirebase);
                    }
                }, 100);
            }, []);

            const handleLogin = async () => {
                const { GoogleAuthProvider, signInWithPopup } = window.FirebaseAPI;
                const provider = new GoogleAuthProvider();
                try {
                    await signInWithPopup(authRef.current, provider);
                } catch (err) {
                    console.error("Login Error:", err);
                }
            };

            const handleLogout = () => {
                window.FirebaseAPI.signOut(authRef.current);
                setSidebarOpen(false);
            };

            useEffect(() => { document.documentElement.classList.toggle('dark', darkMode); }, [darkMode]);

            const navigate = (v) => { window.history.pushState({ view: v }, ''); setView(v); };

            const availableChapters = useMemo(() => {
                if (filters.classLevel === "11") return ["All Chapters", ...CHAPTER_DATA["11"]];
                if (filters.classLevel === "12") return ["All Chapters", ...CHAPTER_DATA["12"]];
                return ["All Chapters", ...CHAPTER_DATA["11"], ...CHAPTER_DATA["12"]];
            }, [filters.classLevel]);

            const startPractice = () => {
                const questions = window.ALL_QUESTIONS || [];
                const filtered = questions.filter(q => {
                    const matchesClass = filters.classLevel === "All" || q.classLevel === filters.classLevel;
                    const matchesChapter = filters.chapter === "All Chapters" || q.chapter === filters.chapter;
                    const matchesYear = q.year >= filters.startYear && q.year <= filters.endYear;
                    return matchesClass && matchesChapter && matchesYear;
                });
                if (filtered.length === 0) return alert("No questions found for this selection!");
                setSession({ questions: filtered, currentIndex: 0, userAnswers: {}, startTime: Date.now() });
                navigate('practice');
            };

            const SmartViewer = ({ res, onClose, type }) => {
                const [innerLoading, setInnerLoading] = useState(true);
                const viewerUrl = type === 'lecture' ? `https://www.youtube.com/embed/${res.link}?autoplay=1` : `https://docs.google.com/viewer?url=${encodeURIComponent(res.link)}&embedded=true`;
                return (
                    <div className="fixed inset-0 z-[250] bg-slate-950 flex flex-col fade-in">
                        <div className="h-16 px-4 flex items-center justify-between bg-slate-900 text-white border-b border-white/5">
                            <div className="flex items-center gap-4">
                                <button onClick={onClose} className="p-2 bg-white/5 rounded-xl"><Icon name="arrow-left" size={20}/></button>
                                <h3 className="text-xs font-black uppercase tracking-widest truncate max-w-[150px]">{res.name}</h3>
                            </div>
                            {type !== 'lecture' && <button onClick={() => window.open(res.link, '_blank')} className="p-2 bg-white/5 rounded-xl"><Icon name="download" size={20}/></button>}
                        </div>
                        <div className="flex-1 relative bg-slate-900 flex items-center justify-center p-2">
                            {innerLoading && <div className="absolute inset-0 flex flex-col items-center justify-center z-20 bg-slate-900/80"><div className="w-12 h-12 border-4 border-indigo-500/20 border-t-indigo-500 rounded-full animate-spin mb-4"></div><p className="text-[10px] font-black text-slate-400">Loading Content...</p></div>}
                            <div className="w-full h-full max-w-5xl bg-white rounded-3xl overflow-hidden shadow-2xl relative">
                                <iframe src={viewerUrl} className="w-full h-full" onLoad={() => setInnerLoading(false)} allowFullScreen></iframe>
                            </div>
                        </div>
                    </div>
                );
            };

            const ResourceListView = ({ type, title, icon, colorClass, dataLinks }) => {
                const [activeRes, setActiveRes] = useState(null);
                const chapters = useMemo(() => {
                    let list = [];
                    Object.entries(CHAPTER_DATA).forEach(([cls, names]) => {
                        if (resourceFilter === "all" || resourceFilter === cls) names.forEach(n => list.push({ name: n, class: cls, link: dataLinks?.[n] || "" }));
                    });
                    return list;
                }, [resourceFilter]);
                return (
                    <div className="min-h-screen flex flex-col bg-slate-50 dark:bg-slate-950 fade-in pb-10">
                        {activeRes && <SmartViewer res={activeRes} type={type} onClose={() => setActiveRes(null)} />}
                        <div className="h-16 px-4 bg-white/90 dark:bg-slate-900/90 border-b dark:border-slate-800 flex items-center justify-between sticky top-0 z-50">
                            <div className="flex items-center gap-3"><button onClick={() => setSidebarOpen(true)} className="p-2"><Icon name="menu" /></button><h3 className="font-black text-sm uppercase">{title}</h3></div>
                            <button onClick={() => navigate('home')} className="p-2"><Icon name="x" size={20}/></button>
                        </div>
                        <div className="p-4 flex gap-2 overflow-x-auto no-scrollbar bg-white dark:bg-slate-900 border-b dark:border-slate-800">
                            {["all", "11", "12"].map(cls => <button key={cls} onClick={() => setResourceFilter(cls)} className={`px-6 h-10 rounded-full font-black text-[10px] uppercase border transition-all ${resourceFilter === cls ? 'bg-indigo-600 text-white' : 'bg-slate-50 dark:bg-slate-800 text-slate-400'}`}>{cls === "all" ? "Both" : `Class ${cls}`}</button>)}
                        </div>
                        <div className="flex-1 p-4 max-w-2xl mx-auto w-full space-y-3">
                            {chapters.map((res, idx) => (
                                <div key={idx} onClick={() => res.link ? setActiveRes(res) : null} className={`bg-white dark:bg-slate-900 rounded-[1.5rem] p-4 border dark:border-slate-800 shadow-sm flex items-center gap-4 transition-all ${!res.link ? 'opacity-50 grayscale' : 'hover:border-indigo-500 cursor-pointer'}`}>
                                    <div className="w-12 h-12 rounded-xl bg-indigo-50 dark:bg-indigo-900/20 flex items-center justify-center text-indigo-600"><Icon name={res.link ? icon : "lock"} size={20} /></div>
                                    <div className="flex-1 min-w-0"><div className="flex justify-between items-start pr-2"><h4 className="font-black dark:text-white truncate text-xs">{res.name}</h4><span className="text-[8px] font-black text-indigo-500 uppercase px-2 py-0.5 bg-indigo-500/10 rounded-md">C{res.class}</span></div><p className="text-[8px] font-bold uppercase text-slate-400 mt-1">{res.link ? "Click to view" : "Coming Soon"}</p></div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const PerformanceView = () => (
                <div className="min-h-screen flex flex-col bg-slate-50 dark:bg-slate-950 fade-in pb-10">
                    <div className="h-16 px-4 border-b dark:border-slate-800 flex items-center gap-4 sticky top-0 bg-white/90 dark:bg-slate-900/90 z-50">
                        <button onClick={() => setSidebarOpen(true)} className="p-2"><Icon name="menu"/></button>
                        <h3 className="font-black text-sm uppercase">Your Performance</h3>
                    </div>
                    <div className="flex-1 p-6 max-w-2xl mx-auto w-full space-y-6 text-center">
                        <div className="bg-white dark:bg-slate-900 p-10 rounded-[3rem] border dark:border-slate-800">
                            <Icon name="bar-chart-2" size={64} className="text-indigo-500 mx-auto mb-4" />
                            <h2 className="text-2xl font-black">Analytics Dashboard</h2>
                            <p className="text-slate-500 mt-2">Chapter-wise insights and AI progress tracking are arriving soon.</p>
                        </div>
                    </div>
                </div>
            );

            const HomeView = () => (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 fade-in">
                    <div className="fixed top-6 left-6 z-50"><button onClick={() => setSidebarOpen(true)} className="p-3 bg-white dark:bg-slate-900 rounded-2xl shadow-xl border dark:border-slate-800"><Icon name="menu"/></button></div>
                    <div className="fixed top-6 right-6 z-50"><button onClick={() => setDarkMode(!darkMode)} className="p-3 bg-white dark:bg-slate-900 rounded-2xl shadow-xl border dark:border-slate-800">{darkMode ? <Icon name="sun" className="text-amber-400"/> : <Icon name="moon" className="text-indigo-500"/>}</button></div>
                    <div className="w-full max-w-md bg-white dark:bg-slate-900 rounded-[3rem] p-8 shadow-2xl border dark:border-slate-800">
                        <div className="text-center mb-10">
                            <div className="inline-flex p-4 bg-indigo-100 dark:bg-indigo-900/30 rounded-2xl mb-4 text-indigo-600"><Icon name="book-open" size={42} /></div>
                            <h1 className="text-4xl font-black dark:text-white mb-1 tracking-tighter">Bio <span className="text-indigo-500">Yantra PYQ</span></h1>
                            <p className="text-slate-400 font-bold uppercase text-[9px] tracking-widest">NCERT Master Training</p>
                        </div>
                        <div className="space-y-6">
                            <div><label className="text-[10px] font-black text-slate-400 uppercase block mb-2 px-1">Class</label><div className="grid grid-cols-3 gap-2">{["All", "11", "12"].map(l => <button key={l} onClick={() => setFilters({...filters, classLevel: l, chapter: "All Chapters"})} className={`h-11 rounded-xl font-bold border transition-all ${filters.classLevel === l ? 'bg-indigo-600 border-indigo-600 text-white shadow-lg' : 'bg-slate-50 dark:bg-slate-800 text-slate-400 border-slate-200 dark:border-slate-700'}`}>{l === "All" ? "Both" : `Class ${l}`}</button>)}</div></div>
                            <div><label className="text-[10px] font-black text-slate-400 uppercase block mb-2 px-1">Chapter</label><select value={filters.chapter} onChange={e => setFilters({...filters, chapter: e.target.value})} className="w-full h-12 bg-slate-50 dark:bg-slate-800 rounded-xl px-4 font-bold dark:text-white border dark:border-slate-700 outline-none">{availableChapters.map(c => <option key={c} value={c}>{c}</option>)}</select></div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-[10px] font-black text-slate-400 uppercase block mb-1">Start Year</label><select value={filters.startYear} onChange={e => setFilters({...filters, startYear: parseInt(e.target.value)})} className="w-full h-11 bg-slate-50 dark:bg-slate-800 rounded-xl px-3 font-bold dark:text-white border dark:border-slate-700">{YEAR_RANGE.map(y => <option key={y} value={y}>{y}</option>)}</select></div>
                                <div><label className="text-[10px] font-black text-slate-400 uppercase block mb-1">End Year</label><select value={filters.endYear} onChange={e => setFilters({...filters, endYear: parseInt(e.target.value)})} className="w-full h-11 bg-slate-50 dark:bg-slate-800 rounded-xl px-3 font-bold dark:text-white border dark:border-slate-700">{YEAR_RANGE.map(y => <option key={y} value={y}>{y}</option>)}</select></div>
                            </div>
                            <button onClick={startPractice} className="w-full py-4 bg-indigo-600 text-white rounded-2xl font-black text-lg shadow-xl active:scale-95 transition-all">START PRACTICE</button>
                            <div className="pt-6 border-t dark:border-slate-800 grid grid-cols-3 gap-2">
                                <button onClick={() => navigate('lecture')} className="py-3 rounded-2xl bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 font-black text-[9px] uppercase flex flex-col items-center gap-1 active:scale-95 border dark:border-indigo-800/50"><Icon name="video" size={18}/> Lecture</button>
                                <button onClick={() => navigate('notes')} className="py-3 rounded-2xl bg-purple-50 dark:bg-purple-900/20 text-purple-600 font-black text-[9px] uppercase flex flex-col items-center gap-1 active:scale-95 border dark:border-indigo-800/50"><Icon name="file-text" size={18}/> Notes</button>
                                <button onClick={() => navigate('mindmap')} className="py-3 rounded-2xl bg-pink-50 dark:bg-pink-900/20 text-pink-600 dark:text-pink-400 font-black text-[9px] uppercase flex flex-col items-center gap-1 active:scale-95 border dark:border-indigo-800/50"><Icon name="brain" size={18}/> Mind Map</button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const PracticeView = () => {
                const q = session.questions[session.currentIndex];
                const ua = session.userAnswers[q?.id];
                if (!q) return null;
                const progressVal = ((session.currentIndex + 1) / session.questions.length) * 100;
                return (
                    <div className="min-h-screen flex flex-col bg-slate-50 dark:bg-slate-950">
                        <div className="h-16 px-4 bg-white/90 dark:bg-slate-900/90 border-b dark:border-slate-800 flex items-center justify-between sticky top-0 z-50">
                            <button onClick={() => navigate('home')} className="p-2"><Icon name="arrow-left"/></button>
                            <div className="text-center flex-1 mx-4 min-w-0 pr-2"><p className="text-[10px] font-black text-indigo-500 uppercase truncate">{q.chapter}</p><p className="text-sm font-bold dark:text-white">Q {session.currentIndex + 1}/{session.questions.length}</p></div>
                            <button onClick={() => navigate('report')} className="px-3 py-1 bg-red-500 text-white rounded-lg text-[10px] font-black uppercase">Finish</button>
                        </div>
                        <div className="w-full h-1.5 bg-slate-200 dark:bg-slate-800"><div className="h-full bg-indigo-500 transition-all duration-300" style={{ width: `${progressVal}%` }} /></div>
                        <div className="flex-1 max-w-3xl mx-auto w-full p-4 pb-24 overflow-y-auto no-scrollbar fade-in">
                            <div className="bg-white dark:bg-slate-900 rounded-[2.5rem] p-8 shadow-sm border dark:border-slate-800 mb-6">
                                <span className="px-3 py-1 bg-indigo-100 dark:bg-indigo-900/40 text-indigo-600 text-[10px] font-black rounded-full mb-4 inline-block uppercase">NEET {q.year}</span>
                                <h2 className="text-xl font-bold dark:text-white leading-relaxed mb-8">{q.question}</h2>
                                <div className="space-y-3">
                                    {q.options.map((opt, i) => {
                                        const isCor = i === q.correctAnswer;
                                        const isSel = ua?.selectedIndex === i;
                                        let style = "bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400";
                                        if (ua) {
                                            if (isCor) style = "bg-green-100 dark:bg-green-900/20 border-green-500 text-green-700 dark:text-green-400 border-2";
                                            else if (isSel) style = "bg-red-100 dark:bg-red-900/20 border-red-500 text-red-700 dark:text-red-400 border-2";
                                        }
                                        return <button key={i} disabled={!!ua} onClick={() => setSession(p => ({ ...p, userAnswers: { ...p.userAnswers, [q.id]: { selectedIndex: i, isCorrect: i === q.correctAnswer } } }))} className={`w-full p-5 rounded-3xl flex items-center border text-left btn-active ${style}`}><span className="w-8 h-8 rounded-full bg-black/5 dark:bg-white/5 flex items-center justify-center font-black mr-4">{String.fromCharCode(65 + i)}</span><span className="font-bold flex-1">{opt}</span></button>;
                                    })}
                                </div>
                            </div>
                            {ua && <div className="p-6 bg-indigo-50 dark:bg-indigo-900/20 rounded-3xl border dark:border-indigo-800 text-sm fade-in"><p className="text-[10px] font-black text-indigo-500 uppercase mb-2">Insight</p><p className="dark:text-slate-300 italic leading-relaxed">{q.solution}</p></div>}
                        </div>
                        <div className="fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-t dark:border-slate-800 flex gap-4 z-50">
                            <button disabled={session.currentIndex === 0} onClick={() => setSession(p => ({...p, currentIndex: p.currentIndex - 1}))} className="flex-1 py-4 bg-slate-100 dark:bg-slate-800 dark:text-white rounded-2xl font-black text-xs disabled:opacity-30">PREV</button>
                            <button onClick={() => session.currentIndex < session.questions.length - 1 ? setSession(p => ({...p, currentIndex: p.currentIndex + 1})) : navigate('report')} className="flex-[2] py-4 bg-indigo-600 text-white rounded-2xl font-black text-xs shadow-lg active:scale-95 transition-all">{session.currentIndex === session.questions.length - 1 ? "FINISH" : (ua ? "NEXT" : "SKIP")}</button>
                        </div>
                    </div>
                );
            };

            const ReportView = () => {
                const [activeReviewFilter, setActiveReviewFilter] = useState('all');
                const stats = useMemo(() => {
                    const total = session.questions.length;
                    const attempted = Object.keys(session.userAnswers).length;
                    const correct = Object.values(session.userAnswers).filter(a => a.isCorrect).length;
                    const incorrect = attempted - correct;
                    const accuracy = attempted > 0 ? Math.round((correct / attempted) * 100) : 0;
                    const score = (correct * 4) - incorrect;
                    return { total, attempted, correct, incorrect, accuracy, score };
                }, []);
                const filteredQuestions = useMemo(() => session.questions.filter(q => {
                    const ua = session.userAnswers[q.id];
                    if (activeReviewFilter === 'correct') return ua?.isCorrect;
                    if (activeReviewFilter === 'incorrect') return ua && !ua.isCorrect;
                    if (activeReviewFilter === 'skipped') return !ua;
                    return true;
                }), [activeReviewFilter]);
                return (
                    <div className="min-h-screen bg-slate-50 dark:bg-slate-950 fade-in pb-20 overflow-y-auto no-scrollbar">
                        <div className="p-6 max-w-2xl mx-auto space-y-6">
                            <div className="flex justify-between items-center"><h2 className="text-3xl font-black dark:text-white">Analysis</h2><button onClick={() => navigate('home')} className="p-3 bg-white dark:bg-slate-900 rounded-2xl shadow-lg dark:text-white"><Icon name="home"/></button></div>
                            <div className="bg-gradient-to-br from-indigo-600 to-indigo-900 p-8 rounded-[3rem] text-white shadow-2xl relative overflow-hidden flex flex-col items-center">
                                <div className="absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none"><Icon name="zap" size={200} className="rotate-12" /></div>
                                <div className="relative z-10 text-center">
                                    <p className="text-[10px] font-black uppercase opacity-60 mb-2">Net Score</p>
                                    <h3 className="text-8xl font-black my-2 tabular-nums">{stats.score}</h3>
                                    <div className="grid grid-cols-2 mt-8 pt-6 border-t border-white/10 gap-8">
                                        <div><p className="text-[10px] font-black uppercase opacity-60">Accuracy</p><p className="text-3xl font-black">{stats.accuracy}%</p></div>
                                        <div><p className="text-[10px] font-black uppercase opacity-60">Attempted</p><p className="text-3xl font-black">{stats.attempted}</p></div>
                                    </div>
                                </div>
                            </div>
                            <div className="pt-6">
                                <h4 className="text-xl font-black dark:text-white mb-4 px-1">Review Portal</h4>
                                <div className="flex gap-2 overflow-x-auto no-scrollbar pb-4 sticky top-0 z-10 bg-slate-50/80 dark:bg-slate-950/80 backdrop-blur-md">
                                    {['all', 'correct', 'incorrect', 'skipped'].map(f => <button key={f} onClick={() => setActiveReviewFilter(f)} className={`px-6 h-10 rounded-full font-black text-[10px] uppercase border transition-all ${activeReviewFilter === f ? 'bg-indigo-600 border-indigo-600 text-white shadow-lg' : 'bg-white dark:bg-slate-900 text-slate-400'}`}>{f}</button>)}
                                </div>
                                <div className="space-y-6 mt-4">
                                    {filteredQuestions.map((q, idx) => {
                                        const ua = session.userAnswers[q.id];
                                        return (
                                            <div key={idx} className="bg-white dark:bg-slate-900 rounded-[2.5rem] p-6 border dark:border-slate-800 shadow-sm">
                                                <div className="flex justify-between items-center mb-6">
                                                    <div className="flex flex-col"><span className="text-[10px] font-black text-indigo-500 uppercase tracking-wider">NEET {q.year}</span><span className="text-[9px] font-bold text-slate-400 uppercase mt-0.5">{q.chapter}</span></div>
                                                    <span className={`px-4 py-1.5 rounded-full text-[9px] font-black uppercase ${!ua ? 'bg-slate-100 text-slate-500' : ua.isCorrect ? 'bg-green-100 text-green-600 dark:text-green-400 border-2' : 'bg-red-100 text-red-600 dark:text-red-400 border-2'}`}>{!ua ? 'Skipped' : ua.isCorrect ? 'Correct' : 'Incorrect'}</span>
                                                </div>
                                                <h5 className="font-bold mb-6 text-lg leading-relaxed">{q.question}</h5>
                                                <div className="space-y-2 mb-6">
                                                    {q.options.map((opt, oIdx) => {
                                                        const isCorrect = oIdx === q.correctAnswer;
                                                        const isSelected = ua?.selectedIndex === oIdx;
                                                        let optStyle = "bg-slate-50 dark:bg-slate-800/50 border-transparent text-slate-500";
                                                        if (isCorrect) optStyle = "bg-green-100 border-green-500 text-green-700 dark:text-green-400 border-2";
                                                        else if (isSelected && !isCorrect) optStyle = "bg-red-100 border-red-500 text-red-700 dark:text-red-400 border-2";
                                                        return <div key={oIdx} className={`p-4 rounded-2xl flex items-center gap-3 text-sm font-bold border ${optStyle}`}><span className={`w-6 h-6 rounded-full flex items-center justify-center text-[10px] ${isCorrect ? 'bg-green-500 text-white' : isSelected ? 'bg-red-500 text-white' : 'bg-black/5 dark:bg-white/5'}`}>{String.fromCharCode(65+oIdx)}</span><span className="flex-1">{opt}</span>{isCorrect && <Icon name="check-circle" size={16}/>}</div>;
                                                    })}
                                                </div>
                                                <div className="bg-indigo-50 dark:bg-indigo-900/10 p-5 rounded-2xl border dark:border-indigo-900/30"><p className="text-[10px] font-black text-indigo-500 uppercase mb-2">NCERT Insight</p><p className="text-xs italic dark:text-slate-300 leading-relaxed">{q.solution}</p></div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            if (loading) return (
                <div className="min-h-screen flex items-center justify-center bg-slate-950">
                    <div className="w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
                </div>
            );

            if (!user) return <AuthWall onLogin={handleLogin} />;

            return (
                <div className="min-h-screen text-slate-900 dark:text-slate-100 selection:bg-indigo-500/30">
                    <Sidebar user={user} isOpen={isSidebarOpen} onClose={() => setSidebarOpen(false)} navigate={navigate} currentView={view} onLogout={handleLogout} />
                    {view === 'home' && <HomeView />}
                    {view === 'performance' && <PerformanceView />}
                    {view === 'practice' && <PracticeView />}
                    {view === 'report' && <ReportView />}
                    {view === 'lecture' && <ResourceListView type="lecture" title="Lectures" icon="video" colorClass="from-indigo-600 to-indigo-800" dataLinks={window.LECTURES_LINKS} />}
                    {view === 'notes' && <ResourceListView type="notes" title="NCERT Notes" icon="file-text" colorClass="from-purple-600 to-purple-800" dataLinks={window.NOTES_LINKS} />}
                    {view === 'mindmap' && <ResourceListView type="mindmap" title="Mind Maps" icon="brain" colorClass="from-pink-600 to-pink-800" dataLinks={window.MINDMAP_LINKS} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

